# 智能类结构对比分析提示词

## 使用场景
在代码重构、版本迁移或重大修改时，仅提供老类和新类的代码，AI自动分析结构差异并生成详细对比报告。

## 自动分析框架

### 第一阶段：结构提取与分析

**请自动执行以下分析步骤：**

1. **类基本信息提取**
   - 类名、包名、修饰符对比
   - 继承关系分析
   - 接口实现对比
   - 泛型参数对比

2. **字段结构分析**
   - 提取所有字段（包括private、protected、public）
   - 分析字段类型、默认值、注解
   - 对比字段访问修饰符变化

3. **方法结构分析**
   - 提取所有方法签名（不含实现细节）
   - 分析方法参数、返回值、异常声明
   - 对比方法访问修饰符变化
   - 识别新增、删除、修改的方法

4. **依赖关系分析**
   - 导入的包依赖对比
   - 使用的注解对比
   - 外部服务调用对比

### 第二阶段：智能差异识别

**请运用以下智能分析逻辑：**

**🔍 关键问题自动识别**
- 公共接口变更风险
- 字段类型不兼容问题
- 方法签名不一致问题
- 依赖版本冲突风险

**🧠 业务逻辑推断**
- 通过方法名推断功能用途
- 通过字段命名推断数据模型
- 通过注解使用推断框架集成

**⚠️ 潜在风险评估**
- 向后兼容性风险
- 性能影响评估
- 安全性影响评估

## 智能对比报告模板

### 第三阶段：自动生成对比报告

**请按照以下结构生成分析报告：**

```
📊 【类结构对比分析报告】

【基本信息对比】
┌─────────────────┬─────────────────┬─────────────────┐
│   对比项目      │   老类          │   新类          │
├─────────────────┼─────────────────┼─────────────────┤
│ 类名           │ [OldClass]      │ [NewClass]      │
│ 包名           │ [OldPackage]    │ [NewPackage]    │
│ 继承关系       │ [OldExtends]    │ [NewExtends]    │
│ 实现接口       │ [OldImplements] │ [NewImplements] │
│ 修饰符         │ [OldModifiers]  │ [NewModifiers]  │
└─────────────────┴─────────────────┴─────────────────┘

【字段结构分析】
🔍 字段变化统计：
• 原有字段：N 个
• 新增字段：N 个
• 删除字段：N 个
• 修改字段：N 个

📋 详细字段对比：
┌──────────────┬─────────────┬─────────────┬──────────────┐
│ 字段名       │ 老类类型     │ 新类类型     │ 状态         │
├──────────────┼─────────────┼─────────────┼──────────────┤
│ [fieldName]  │ [OldType]   │ [NewType]   │ ✅/⚠️/❌     │
└──────────────┴─────────────┴─────────────┴──────────────┘
状态说明：✅ 完全一致  ⚠️ 类型变更  ❌ 删除/缺失

【方法结构分析】
🔍 方法变化统计：
• 原有方法：N 个
• 新增方法：N 个
• 删除方法：N 个
• 修改方法：N 个

📋 详细方法对比：
┌──────────────┬─────────────┬─────────────┬──────────────┐
│ 方法签名     │ 老类         │ 新类         │ 兼容性评估   │
├──────────────┼─────────────┼─────────────┼──────────────┤
│ [methodSig]  │ [OldAccess] │ [NewAccess] │ ✅/⚠️/❌     │
└──────────────┴─────────────┴─────────────┴──────────────┘

【依赖关系分析】
📦 导入包变化：
• 新增依赖：[dependency list]
• 删除依赖：[dependency list]
• 版本变更：[version changes]

🔧 注解变化：
• 新增注解：[annotation list]
• 删除注解：[annotation list]
• 注解参数变更：[annotation changes]

【风险评估与建议】
🚨 高风险项：
• [高风险问题及影响]

⚠️ 中风险项：
• [中风险问题及建议]

💡 优化建议：
• [改进建议]

【兼容性结论】
✅ 完全兼容：[compatible items]
⚠️ 部分兼容：[partially compatible items]  
❌ 不兼容：[incompatible items]
```

## 智能分析思路

### 第四阶段：深度业务逻辑推断

**请运用业务逻辑分析能力：**

**🎯 功能意图识别**
- 通过方法名模式识别CRUD操作
- 通过字段命名识别数据模型含义
- 通过注解使用识别框架集成点
- 通过异常类型识别错误处理策略

**🔄 生命周期分析**
- 对象创建模式对比（构造函数 vs Builder模式）
- 资源管理方式对比（手动管理 vs 自动管理）
- 状态变更模式对比（setter vs 不可变对象）

**🏗️ 架构模式识别**
- 依赖注入方式变化
- 设计模式应用对比
- 分层架构实现差异

### 第五阶段：影响范围评估

**请进行智能影响分析：**

**📈 变更影响矩阵**
| 变更类型 | 影响范围 | 风险等级 | 建议措施 |
|---------|---------|---------|----------|
| 字段类型变更 | 序列化/反序列化 | 高 | 增加版本兼容层 |
| 方法参数变更 | 调用方代码 | 高 | 提供重载方法 |
| 访问修饰符变更 | 继承体系 | 中 | 更新访问控制 |
| 注解变更 | 框架集成 | 中 | 验证框架兼容性 |

**🎭 兼容性策略建议**
- 向后兼容：保持公共接口不变
- 向前兼容：新版本兼容旧调用
- 版本隔离：通过版本包名区分
- 迁移策略：提供过渡期和迁移工具

## 使用示例

### 完整分析示例

```
【输入】
请分析以下两个类的结构差异：

【老类】ClaimService.java
【新类】ClaimBusinessService.java

【输出】
📊 【智能分析报告】

【结构概览】
• 复杂度变化：老类15个方法 → 新类18个方法 (+20%)
• 职责变化：从Service层 → Business层
• 设计模式：从单体类 → 策略模式 + 工厂模式

【关键发现】
🔍 命名模式变化：
• getClaims → findClaimsByUser
• createClaim → saveClaimWithValidation
• updateClaim → updateClaimWithAuditLog

⚠️ 兼容性风险：
• deleteClaim方法删除（需要确认业务需求）
• 方法参数从String userId → UserContext userContext

✅ 改进亮点：
• 增加参数校验
• 增加审计日志
• 统一异常处理
• 增加缓存机制

【迁移建议】
1. 立即行动：保留旧方法作为包装器
2. 短期计划：逐步迁移调用方
3. 长期计划：移除兼容层
```

## AI智能分析工具集成

### 第六阶段：自动化分析增强

**AI应该主动运用的分析工具：**

**🔧 静态分析能力**
- 自动识别设计模式应用
- 检测代码复杂度变化
- 分析依赖关系图谱
- 识别代码异味和反模式

**📊 量化指标分析**
- 圈复杂度对比
- 代码行数统计
- 方法数量变化
- 字段数量变化
- 依赖数量变化

**🎯 业务语义分析**
- 通过命名约定识别业务概念
- 分析数据流和控制流变化
- 识别重构模式（Extract Class、Move Method等）

## 智能提示词模板

### 完整分析请求格式

```
【请使用此模板进行分析】

请对以下两个Java类进行全面的智能结构对比分析：

【分析目标】
- 老类：{老类完整代码}
- 新类：{新类完整代码}

【分析要求】
请按照以下智能分析流程进行：

1. 【结构提取阶段】
   - 自动提取类基本信息（包名、类名、修饰符、继承、实现）
   - 提取所有字段信息（类型、修饰符、注解、默认值）
   - 提取所有方法信息（签名、参数、返回值、异常、修饰符）
   - 分析依赖关系（imports、注解使用）

2. 【智能对比阶段】
   - 进行字段逐项对比，标注新增、删除、修改
   - 进行方法逐项对比，评估兼容性风险
   - 分析依赖变化对系统的影响
   - 识别架构模式和设计模式变化

3. 【业务推断阶段】
   - 通过命名模式推断业务功能
   - 分析对象生命周期变化
   - 识别代码质量改进点
   - 评估重构的合理性

4. 【影响评估阶段】
   - 评估对现有系统的兼容性影响
   - 分析对调用方的影响范围
   - 识别潜在的运行时风险
   - 提供迁移策略建议

【输出要求】
请按照智能对比报告模板生成详细分析报告，包括：
- 结构化对比表格
- 风险等级评估
- 具体改进建议
- 迁移行动清单

【注意事项】
- 重点关注公共API的变化
- 识别可能的破坏性变更
- 提供向后兼容性建议
- 考虑测试覆盖的影响
```

## 使用最佳实践

### 第七阶段：结果应用指导

**📋 分析结果解读指南**
- **高风险项**: 需要立即处理，可能影响系统稳定性
- **中风险项**: 需要在迁移过程中特别注意
- **低风险项**: 优化改进，可在后续版本处理
- **新功能项**: 增强功能，需要验证业务需求

**🎯 迁移决策矩阵**
| 风险等级 | 影响范围 | 决策建议 | 时间规划 |
|---------|---------|---------|---------|
| 高 | 核心功能 | 暂缓上线，增加兼容层 | 1-2周 |
| 中 | 辅助功能 | 灰度发布，监控指标 | 3-5天 |
| 低 | 优化改进 | 直接上线 | 1天 |

**📈 成功评估标准**
- ✅ 功能完整性: 100%覆盖原有功能
- ✅ 性能稳定性: 关键指标无明显下降
- ✅ 兼容性保持: 现有调用无需修改
- ✅ 代码质量: 符合团队编码规范

---

## 快速使用指南

**💡 简洁版提示词：**

```
请对比分析以下两个Java类的结构差异，并生成详细的对比报告：

老类：{老类代码}
新类：{新类代码}

请自动执行：
1. 结构对比分析
2. 兼容性风险评估  
3. 迁移建议制定
4. 影响范围分析

输出要求：结构化报告，包含表格对比、风险评估、行动建议。
```

**🚀 高级版提示词：**

```
对以下类进行深度智能分析，重点关注业务语义变化和架构模式演进：

[类代码对比]

请从以下维度分析：
- 领域模型演进分析
- 业务规则变化识别
- 性能优化措施评估
- 安全性改进点分析
- 可维护性提升评估

生成包含执行计划的风险评估报告。
```

通过这套智能化的分析框架，AI能够自动完成复杂的类结构对比分析，为代码重构提供专业级的分析报告和迁移指导。


#方法实现细节可能不同，需要提供具体哪里不同，不需要太细，我没时间阅读，是需要判断新代码是否有遗漏
#需要有代码逻辑清单对比，新类最好有对应
#老代码注释掉的不用分析了，直接忽略，不用确认
#老代码没被调用的也不用分析了，直接忽略，不用确认
#依赖注入没被使用也不用分析了，直接忽略，不用确认
#注释掉的代码需要帮忙展示出来
#父类是否有实现，需要你帮忙去深入分析
#检查代码是否有重复实现，是否有多余的代码
